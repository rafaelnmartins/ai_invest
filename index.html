<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI Investimentos ‚Äî Dashboard Pro</title>
  <link rel="preconnect" href="https://s3.tradingview.com" crossorigin>
  <style>
    :root{
      --bg:#0b1220; --panel:#0f172a; --ink:#e5e7eb; --muted:#94a3b8; --acc:#38bdf8; --line:rgba(148,163,184,.14)
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:radial-gradient(1200px 600px at 10% -10%, rgba(56,189,248,.08), transparent), #0b1220;color:var(--ink);font:14px/1.6 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
    a{color:var(--acc);text-decoration:none}

    .wrap{max-width:1200px;margin:0 auto;padding:26px}

    /* Hero */
    .hero{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:40px;height:40px;border-radius:12px;background:conic-gradient(from 210deg,#22d3ee,#6366f1,#22d3ee);box-shadow:0 0 0 6px rgba(56,189,248,.06)}
    h1{font-size:20px;margin:0}
    .btn{cursor:pointer;border-radius:10px;border:1px solid var(--line);background:#0b1220;padding:10px 12px;color:var(--ink)}
    .btn:hover{background:#0e1526}

    /* KPI bar */
    .kpis{display:grid;grid-template-columns:repeat(12,1fr);gap:12px;margin:16px 0}
    .kpi{grid-column:span 3;background:linear-gradient(180deg,#0f172a,#0d1528);border:1px solid var(--line);border-radius:14px;padding:12px 14px}
    .kpi h4{margin:0 0 6px 0;font-size:12px;color:#93c5fd;text-transform:uppercase;letter-spacing:.6px}
    .kpi p{margin:0;font-size:18px}

    /* Grid blocks */
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
    .card{background:linear-gradient(180deg,#0f172a,#0d1426);border:1px solid var(--line);border-radius:16px;padding:18px}
    h2{margin:0 0 10px 0;font-size:16px}
    p.status{font-size:12px;color:var(--muted)}

    /* Sections */
    .quick{grid-column:span 12}
    #ai-opinion{grid-column:span 8}
    .alerts{grid-column:span 4}
    .positions{grid-column:span 12}
    .chart{grid-column:span 8}
    .chart-tips{grid-column:span 4}

    /* Table */
    table{width:100%;border-collapse:separate;border-spacing:0}
    th,td{padding:10px 12px;border-bottom:1px solid var(--line);text-align:left}
    th{font-size:12px;color:#94a3b8}

    /* Lists & badges */
    .tips{margin:0;padding-left:18px}
    .tips li{margin:6px 0;color:var(--muted)}
    .badge{display:inline-flex;align-items:center;gap:6px;font-size:12px;color:#38bdf8;background:rgba(56,189,248,.08);border:1px solid rgba(56,189,248,.25);border-radius:999px;padding:2px 8px}
    input,select,textarea{font:inherit;border-radius:10px;border:1px solid var(--line);background:#0b1220;color:var(--ink);padding:10px 12px}

    @media (max-width:1024px){
      #ai-opinion,.alerts,.chart,.chart-tips{grid-column:span 12}
      .kpi{grid-column:span 6}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- HERO -->
    <div class="hero">
      <div class="brand">
        <div class="logo"></div>
        <h1>AI Investimentos</h1>
      </div>
      <button id="langToggle" class="btn">üáßüá∑/üá∫üá∏ <span id="langLabel">PT</span></button>
    </div>

    <!-- KPI BAR -->
    <div class="kpis">
      <div class="kpi"><h4>Status</h4><p id="kpiStatus">Mercado Fechado</p></div>
      <div class="kpi"><h4>Foco</h4><p>Large Caps üá∫üá∏</p></div>
      <div class="kpi"><h4>Risco</h4><p>Moderado</p></div>
      <div class="kpi"><h4>√ölt. atualiza√ß√£o</h4><p id="y">‚Äî</p></div>
    </div>

    <!-- (1) QUICK TIPS -->
    <section class="card quick">
      <h2 id="quickTitle">Dicas r√°pidas</h2>
      <ul class="tips" id="quickTips">
        <li>Agente envia alertas <strong>ap√≥s o fechamento</strong> de NY.</li>
        <li>Curto: <strong>+5%</strong> | Longo: <strong>+10%</strong>.</li>
        <li>Use stop e acompanhe <strong>vendas</strong>.</li>
      </ul>
    </section>

    <!-- (2) AI + ALERTAS -->
    <div class="grid">
      <section class="card" id="ai-opinion">
        <h2>Opini√£o da AI (T√©cnico + Analistas)</h2>
        <div class="grid" style="grid-template-columns:repeat(12,1fr);gap:10px;margin:8px 0 12px 0">
          <input id="aiSymbolInput" placeholder="Ex.: NASDAQ:AMZN ou AMZN" style="grid-column:span 6" />
          <button id="aiAnalyzeBtn" class="btn" style="grid-column:span 3">Analisar</button>
          <button id="aiUseChartBtn" class="btn" style="grid-column:span 3">Usar s√≠mbolo do gr√°fico</button>
        </div>
        <div id="aiResult" class="card" style="background:#0b1220;border:1px dashed rgba(148,163,184,.18);min-height:90px"></div>
        <div id="grokBox" class="card" style="margin-top:10px;background:#0b1220;border:1px solid rgba(148,163,184,.18)">
          <h3 style="margin:0 0 8px 0" id="grokTitle">Opini√£o extra da IA (Grok)</h3>
          <div id="grokOpinion" class="status">‚Äî</div>
        </div>
        <p class="status" id="aiStatus"></p>
      </section>

      <section class="card alerts">
        <div style="display:flex;align-items:center;justify-content:space-between;gap:8px">
          <h2 id="alertsTitle">Alertas</h2>
          <span class="badge">‚ö° Agent</span>
        </div>
        <iframe
          src="https://shiny-sea-44d3.rafaelnm.workers.dev/"
          id="alertsFrame"
          title="Alertas ‚Äì Cloudflare Worker"
          loading="lazy"
          referrerpolicy="no-referrer"
          style="width:100%;height:520px;border:1px solid rgba(148,163,184,.18);border-radius:12px;background:#0b1220;color:#ffffff;">
        </iframe>
      </section>
    </div>

    <!-- (3) POSI√á√ïES -->
    <section class="card positions" id="positions">
      <div style="display:flex;align-items:center;gap:8px;justify-content:space-between;flex-wrap:wrap">
        <h2 id="positionsTitle">Minhas posi√ß√µes</h2>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <span class="badge" title="Vis√≠vel para todos">üåê P√∫blico</span>
          <button id="loadPublicBtn" class="btn">Atualizar p√∫blicas</button>
          <button id="publishBtn" class="btn">Publicar (admin)</button>
        </div>
      </div>
      <div class="grid" style="grid-template-columns:repeat(12,1fr);gap:10px;margin:8px 0 12px 0">
        <input id="posSymbol" placeholder="Ex.: NASDAQ:NVDA ou BMFBOVESPA:PETR4" style="grid-column:span 6" />
        <input id="posAvg" type="number" inputmode="decimal" step="0.01" placeholder="Pre√ßo m√©dio" style="grid-column:span 3" />
        <input id="posNote" placeholder="Observa√ß√£o (opcional)" style="grid-column:span 3" />
      </div>
      <div style="display:flex;gap:10px;flex-wrap:wrap">
        <button id="addPosBtn" class="btn">Adicionar posi√ß√£o</button>
        <button id="refreshBtn" class="btn">Atualizar pre√ßos</button>
        <button id="clearAllBtn" class="btn">Limpar locais</button>
        <button id="exportBtn" class="btn">Exportar CSV</button>
      </div>
      <p class="status" id="quoteStatus"></p>
      <div style="overflow:auto;margin-top:12px">
        <table id="posTable">
          <thead>
            <tr>
              <th>S√≠mbolo</th><th>Pre√ßo m√©dio</th><th>Pre√ßo atual</th><th>P/L %</th><th>Obs.</th><th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <p id="totals" class="status" style="margin-top:10px"></p>
      <p id="lastRefresh" class="status"></p>
    </section>

    <!-- (4) CHART + TIPS -->
    <div class="grid">
      <section class="card chart" id="chart">
        <h2 id="chartTitle">Gr√°fico (TradingView)</h2>
        <div class="grid" style="grid-template-columns:repeat(12,1fr);gap:10px;margin:0 0 10px 0">
          <input id="chartSymbolInput" placeholder="Ex.: NASDAQ:NVDA ou BMFBOVESPA:PETR4" style="grid-column:span 6" />
          <button id="setChartBtn" class="btn" style="grid-column:span 2">Carregar s√≠mbolo</button>
          <button id="addFromChartBtn" class="btn" style="grid-column:span 2">Adicionar √† lista</button>
          <a id="openTV" class="btn" style="grid-column:span 2;text-align:center" href="https://www.tradingview.com/chart/" target="_blank" rel="noopener">Abrir no TradingView</a>
        </div>
        <div id="tradingview_chart" style="height:520px;width:100%"></div>
        <p class="status" id="tvStatus"></p>
      </section>

      <section class="card chart-tips">
        <h2 id="chartTipsTitle">Boas pr√°ticas no gr√°fico</h2>
        <ul class="tips" id="chartTips">
          <li>N√£o dependa de um √∫nico indicador.</li>
          <li>Tend√™ncia (SMA50 vs SMA200) antes do gatilho.</li>
          <li>Entrada parcial + adi√ß√£o na confirma√ß√£o.</li>
          <li>Stop t√©cnico e alvo definidos previamente.</li>
          <li>Cheque not√≠cias e earnings.</li>
        </ul>
      </section>
    </div>

    <!-- TICKER -->
    <section class="card">
      <h2>Mercados Globais &amp; Magnificent 7</h2>
      <div class="tradingview-widget-container">
        <div class="tradingview-widget-container__widget"></div>
        <script src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>
        {
          "symbols":[
            {"proName":"FOREXCOM:US30","title":"Dow Jones"},
            {"proName":"FOREXCOM:US100","title":"Nasdaq 100"},
            {"proName":"FOREXCOM:US500","title":"S&P 500"},
            {"proName":"BMFBOVESPA:IBOV","title":"Ibovespa"},
            {"proName":"FOREXCOM:EU50","title":"Euro Stoxx 50"},
            {"proName":"FOREXCOM:UK100","title":"FTSE 100"},
            {"proName":"NASDAQ:AAPL","title":"Apple"},
            {"proName":"NASDAQ:MSFT","title":"Microsoft"},
            {"proName":"NASDAQ:GOOGL","title":"Alphabet"},
            {"proName":"NASDAQ:AMZN","title":"Amazon"},
            {"proName":"NASDAQ:NVDA","title":"NVIDIA"},
            {"proName":"NASDAQ:META","title":"Meta"},
            {"proName":"NASDAQ:TSLA","title":"Tesla"}],
          "showSymbolLogo":true,"isTransparent":false,"displayMode":"adaptive","colorTheme":"dark"
        }
        </script>
      </div>
    </section>

    <p class="status" style="text-align:center;color:#64748b">¬© <span id="y"></span> ‚Ä¢ Site educacional, n√£o √© recomenda√ß√£o de investimento.</p>
  </div>

  <script src="https://s3.tradingview.com/tv.js"></script>
  <!-- === Cole aqui o MESMO <script> do seu projeto atual (JS inalterado) === -->
  <script>
    // S√≥ para exibir o ano caso o seu JS n√£o rode ainda:
    document.getElementById('y').textContent = new Date().getFullYear();
  </script>
</body>
</html>
