<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI Investimentos ‚Äî Sidebar Pro</title>
  <link rel="preconnect" href="https://s3.tradingview.com" crossorigin>
  <style>
    :root{
      --bg:#0b1220; --panel:#0f172a; --ink:#e2e8f0; --muted:#94a3b8; --acc:#22d3ee;
      --line:rgba(148,163,184,.12); --glow:0 10px 40px rgba(34,211,238,.12)
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,#0b1220 0%, #0b1220 50%, #0a0f1a 100%);color:var(--ink);font:14px/1.5 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
    a{color:var(--acc);text-decoration:none}

    /* Shell */
    .shell{display:grid;grid-template-columns:280px 1fr;min-height:100dvh}

    /* Sidebar */
    .side{
      position:sticky;top:0;align-self:start;height:100dvh;display:flex;flex-direction:column;
      padding:22px;border-right:1px solid var(--line);background:rgba(15,23,42,.65);backdrop-filter: blur(8px)
    }
    .brand{display:flex;align-items:center;gap:12px;margin-bottom:18px}
    .logo{width:36px;height:36px;border-radius:10px;background:conic-gradient(from 210deg,#22d3ee,#6366f1,#22d3ee);box-shadow:var(--glow)}
    h1{font-size:16px;margin:0;color:#f8fafc;letter-spacing:.2px}
    .btn{cursor:pointer;border-radius:10px;border:1px solid var(--line);background:#0b1220;padding:8px 10px;color:var(--ink)}
    .btn:hover{background:#0e1526}
    .side .block{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:14px;margin-top:14px;box-shadow:var(--glow)}
    .side h3{margin:0 0 8px 0;font-size:13px;color:#cbd5e1}
    .tips{padding-left:18px;margin:0}
    .tips li{margin:6px 0;color:var(--muted)}
    .nav{display:grid;gap:8px;margin-top:auto}
    .nav a{display:flex;align-items:center;gap:8px;border:1px solid var(--line);background:#0b1220;border-radius:10px;padding:10px 12px;color:#cbd5e1}
    .nav a:hover{background:#0e1526}

    /* Main area */
    .main{padding:24px;display:grid;gap:16px}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:18px;box-shadow:var(--glow)}
    h2{margin:0 0 10px 0;font-size:16px;color:#e5e7eb}
    p.status{color:var(--muted);font-size:12px;margin-top:6px}

    /* Layout blocks */
    .quick{grid-column:span 12}
    #ai-opinion{grid-column:span 8}
    .alerts{grid-column:span 4}
    .positions{grid-column:span 12}
    .chart{grid-column:span 8}
    .chart-tips{grid-column:span 4}

    /* Table */
    table{width:100%;border-collapse:separate;border-spacing:0}
    th,td{padding:10px 12px;border-bottom:1px solid var(--line);text-align:left}
    th{font-size:12px;color:#94a3b8}

    /* Badges */
    .badge{display:inline-flex;align-items:center;gap:6px;font-size:12px;color:#22d3ee;background:rgba(34,211,238,.08);border:1px solid rgba(34,211,238,.25);border-radius:999px;padding:2px 8px}

    /* Inputs */
    input,select,textarea{font:inherit;border-radius:10px;border:1px solid var(--line);background:#0b1220;color:var(--ink);padding:10px 12px}

    /* Responsive */
    @media (max-width:1024px){
      .shell{grid-template-columns:1fr}
      .side{position:static;height:auto}
      #ai-opinion,.alerts,.chart,.chart-tips{grid-column:span 12}
    }
  </style>
</head>
<body>
  <div class="shell">
    <!-- SIDEBAR -->
    <aside class="side">
      <div class="brand">
        <div class="logo"></div>
        <h1>AI Investimentos</h1>
      </div>
      <button id="langToggle" class="btn" style="width:100%">üáßüá∑/üá∫üá∏ <span id="langLabel">PT</span></button>

      <div class="block">
        <h3>Dicas r√°pidas</h3>
        <ul class="tips" id="quickTips">
          <li>Agente envia alertas <strong>ap√≥s o fechamento</strong> de NY.</li>
          <li>Compra curto: <strong>+5%</strong> ¬∑ Longo: <strong>+10%</strong>.</li>
          <li>Fique atento aos <strong>stops</strong> e √†s <strong>vendas</strong>.</li>
        </ul>
      </div>

      <div class="nav">
        <a href="#ai-opinion">ü§ñ Opini√£o da AI</a>
        <a href="#positions">üìä Minhas posi√ß√µes</a>
        <a href="#chart">üìà Gr√°fico</a>
      </div>
    </aside>

    <!-- MAIN -->
    <main class="main">
      <!-- (1) QUICK TIPS (extra header card if quiser) -->
      <section class="card quick" aria-labelledby="quickTitle">
        <h2 id="quickTitle">Dicas r√°pidas</h2>
        <p class="status">Regras simples para decis√µes mais consistentes.</p>
      </section>

      <!-- (2) AI + ALERTAS -->
      <div class="grid">
        <section class="card" id="ai-opinion">
          <h2>Opini√£o da AI (T√©cnico + Analistas)</h2>
          <div class="grid" style="grid-template-columns:repeat(12,1fr);gap:10px;margin:8px 0 12px 0">
            <input id="aiSymbolInput" placeholder="Ex.: NASDAQ:AMZN ou AMZN" style="grid-column:span 6" />
            <button id="aiAnalyzeBtn" class="btn" style="grid-column:span 3">Analisar</button>
            <button id="aiUseChartBtn" class="btn" style="grid-column:span 3">Usar s√≠mbolo do gr√°fico</button>
          </div>
          <div id="aiResult" class="card" style="background:#0b1220;border:1px dashed var(--line);min-height:90px"></div>
          <div id="grokBox" class="card" style="margin-top:10px;background:#0b1220;border:1px solid var(--line)">
            <h3 style="margin:0 0 8px 0">Opini√£o extra da IA (Grok)</h3>
            <div id="grokOpinion" class="status">‚Äî</div>
          </div>
          <p class="status" id="aiStatus"></p>
        </section>

        <section class="card alerts">
          <div style="display:flex;align-items:center;justify-content:space-between;gap:8px">
            <h2>Alertas</h2>
            <span class="badge">‚ö° Agent</span>
          </div>
          <iframe
            src="https://shiny-sea-44d3.rafaelnm.workers.dev/"
            id="alertsFrame"
            title="Alertas ‚Äì Cloudflare Worker"
            loading="lazy"
            referrerpolicy="no-referrer"
            style="width:100%;height:520px;border:1px solid var(--line);border-radius:12px;background:#0b1220;color:#ffffff;">
          </iframe>
        </section>
      </div>

      <!-- (3) POSI√á√ïES -->
      <section class="card positions" id="positions">
        <div style="display:flex;align-items:center;gap:8px;justify-content:space-between;flex-wrap:wrap">
          <h2>Minhas posi√ß√µes</h2>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="badge" title="Vis√≠vel para todos">üåê P√∫blico</span>
            <button id="loadPublicBtn" class="btn">Atualizar p√∫blicas</button>
            <button id="publishBtn" class="btn" title="Enviar posi√ß√µes locais para o servidor (admin)">Publicar (admin)</button>
          </div>
        </div>
        <div class="grid" style="grid-template-columns:repeat(12,1fr);gap:10px;margin:8px 0 12px 0">
          <input id="posSymbol" placeholder="Ex.: NASDAQ:NVDA ou BMFBOVESPA:PETR4" style="grid-column:span 6" />
          <input id="posAvg" type="number" inputmode="decimal" step="0.01" placeholder="Pre√ßo m√©dio" style="grid-column:span 3" />
          <input id="posNote" placeholder="Observa√ß√£o (opcional)" style="grid-column:span 3" />
        </div>
        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <button id="addPosBtn" class="btn">Adicionar posi√ß√£o</button>
          <button id="refreshBtn" class="btn">Atualizar pre√ßos</button>
          <button id="clearAllBtn" class="btn">Limpar locais</button>
          <button id="exportBtn" class="btn">Exportar CSV</button>
        </div>
        <p class="status" id="quoteStatus"></p>
        <div style="overflow:auto;margin-top:12px">
          <table id="posTable">
            <thead>
              <tr>
                <th>S√≠mbolo</th><th>Pre√ßo m√©dio</th><th>Pre√ßo atual</th><th>P/L %</th><th>Obs.</th><th>A√ß√µes</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <p id="totals" class="status" style="margin-top:10px"></p>
        <p id="lastRefresh" class="status"></p>
      </section>

      <!-- (4) GR√ÅFICO + DICAS DO GR√ÅFICO -->
      <div class="grid">
        <section class="card chart" id="chart">
          <h2>Gr√°fico (TradingView)</h2>
          <div class="grid" style="grid-template-columns:repeat(12,1fr);gap:10px;margin:0 0 10px 0">
            <input id="chartSymbolInput" placeholder="Ex.: NASDAQ:NVDA ou BMFBOVESPA:PETR4" style="grid-column:span 6" />
            <button id="setChartBtn" class="btn" style="grid-column:span 2">Carregar s√≠mbolo</button>
            <button id="addFromChartBtn" class="btn" style="grid-column:span 2">Adicionar √† lista</button>
            <a id="openTV" class="btn" style="grid-column:span 2;text-align:center" href="https://www.tradingview.com/chart/" target="_blank" rel="noopener">Abrir no TradingView</a>
          </div>
          <div id="tradingview_chart" style="height:520px;width:100%"></div>
          <p class="status" id="tvStatus"></p>
        </section>

        <section class="card chart-tips">
          <h2>Boas pr√°ticas no gr√°fico</h2>
          <ul class="tips" id="chartTips">
            <li>Confirme com 2‚Äì3 sinais, n√£o 1 s√≥.</li>
            <li>Tend√™ncia (SMA50 vs SMA200) primeiro.</li>
            <li>Entre parcial e adicione se confirmar.</li>
            <li>Defina stop t√©cnico e alvo antes.</li>
            <li>Revise not√≠cias/earnings relevantes.</li>
          </ul>
        </section>
      </div>

      <!-- TICKER -->
      <section class="card">
        <h2>Mercados Globais &amp; Magnificent 7</h2>
        <div class="tradingview-widget-container">
          <div class="tradingview-widget-container__widget"></div>
          <script src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>
          {
            "symbols":[
              {"proName":"FOREXCOM:US30","title":"Dow Jones"},
              {"proName":"FOREXCOM:US100","title":"Nasdaq 100"},
              {"proName":"FOREXCOM:US500","title":"S&P 500"},
              {"proName":"BMFBOVESPA:IBOV","title":"Ibovespa"},
              {"proName":"FOREXCOM:EU50","title":"Euro Stoxx 50"},
              {"proName":"FOREXCOM:UK100","title":"FTSE 100"},
              {"proName":"NASDAQ:AAPL","title":"Apple"},
              {"proName":"NASDAQ:MSFT","title":"Microsoft"},
              {"proName":"NASDAQ:GOOGL","title":"Alphabet"},
              {"proName":"NASDAQ:AMZN","title":"Amazon"},
              {"proName":"NASDAQ:NVDA","title":"NVIDIA"},
              {"proName":"NASDAQ:META","title":"Meta"},
              {"proName":"NASDAQ:TSLA","title":"Tesla"}],
            "showSymbolLogo":true,"isTransparent":false,"displayMode":"adaptive","colorTheme":"dark"
          }
          </script>
        </div>
      </section>

      <p class="status" style="text-align:center;color:#64748b">¬© <span id="y"></span> ‚Ä¢ Site educacional, n√£o √© recomenda√ß√£o de investimento.</p>
    </main>
  </div>

  <script src="https://s3.tradingview.com/tv.js"></script>
  <!-- === Cole aqui o MESMO <script> do seu projeto atual (JS inalterado) === -->
  <script>
    // S√≥ para exibir o ano caso o seu JS n√£o rode ainda:
    document.getElementById('y').textContent = new Date().getFullYear();
  </script>
</body>
</html>
